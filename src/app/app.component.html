<main>
  <header class="header">
    <h1 class="hidden-mobile">Cal Calculator</h1>

    <label for="input-file-id" class="btn" matRipple>
      <mat-icon style="height: 20px; width: 20px; font-size: 20px">upload_file</mat-icon>
      Choose File
    </label>
    <input #csvInput id="input-file-id" hidden type="file" onclick="this.value=null" (change)="onUpload(csvInput.files)" accept=".xlsx, .xls"/>

    <label *ngIf="csvInput.files?.length" class="hidden-mobile">{{ csvInput.files?.item(0)?.name }}</label>

    <label class="goto" matRipple [hidden]="csvInput.files?.length">
      <a href="https://digital-web.cal-online.co.il/transactions" target="_blank">
        CAL website
      </a>
    </label>

    <label matRipple (click)="calLogin()" style="flex-basis: 70px">
      <span style="text-decoration: underline">Login</span>
    </label>

    <div class="flex-separator hidden-mobile"></div>

    <label *ngIf="calRecords">
      {{ calRecords.at(0)?.date | date:'MMM d' }} â€“ {{ calRecords.at(-2)?.date | date }}
    </label>

    <label *ngIf="!calRecords" class="" matRipple (click)="onExampleLoad()">
      <span style="text-decoration: underline">Load example</span>
    </label>
  </header>

  <div id="filter-area" class="filter-area">
    <mat-form-field>
      <mat-label>Filter</mat-label>
      <input matInput #filter>
      <span matSuffix [style.opacity]="filter.value ? 1 : 0" aria-label="Clear" (click)="filter.value = ''" style="cursor: pointer">
        <svg xmlns="http://www.w3.org/2000/svg" height="18px" width="18px" viewBox="0 -5 24 24" fill="gray">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </span>
    </mat-form-field>
    <div style="flex-grow: 1" class="hidden-mobile"></div>
    <mat-slide-toggle (click)="showGraph = !showGraph" style="padding-top: 10px"><span class="hidden-mobile">Show</span> Graph</mat-slide-toggle>

    <a href="#footer" matRipple class="go-down" [hidden]="!calRecords || calRecords.length < 10">Scroll down</a>
  </div>

  <div class="graph-container mat-elevation-z5" *ngIf="showGraph">
    <ngx-charts-advanced-pie-chart
      [results]="graphData"
      [gradient]="false"
      [customColors]="activeCategory"
      (select)="onGraphCategorySelect($event)"
      [animations]="true"
    >
    </ngx-charts-advanced-pie-chart>
  </div>

  <app-table [records]="calRecords" [(filterText)]="filter.value" class="mat-elevation-z5"/>

  <a href="#filter-area" matRipple title="Go up" style="position: fixed; top: 80vh; right: 25px; border-radius: 50%; opacity: 60%" *ngIf="calRecords && calRecords.length > 10">
    <svg style="border-radius: 50%; background: white" xmlns="http://www.w3.org/2000/svg" height="48" width="48">
      <path d="M22.5 31.4h3v-9.1l3.7 3.7 2.1-2.1-7.3-7.3-7.3 7.3 2.1 2.1 3.7-3.7ZM24 44q-4.1 0-7.75-1.575-3.65-1.575-6.375-4.3-2.725-2.725-4.3-6.375Q4 28.1 4 24q0-4.15 1.575-7.8 1.575-3.65 4.3-6.35 2.725-2.7 6.375-4.275Q19.9 4 24 4q4.15 0 7.8 1.575 3.65 1.575 6.35 4.275 2.7 2.7 4.275 6.35Q44 19.85 44 24q0 4.1-1.575 7.75-1.575 3.65-4.275 6.375t-6.35 4.3Q28.15 44 24 44Zm0-3q7.1 0 12.05-4.975Q41 31.05 41 24q0-7.1-4.95-12.05Q31.1 7 24 7q-7.05 0-12.025 4.95Q7 16.9 7 24q0 7.05 4.975 12.025Q16.95 41 24 41Zm0-17Z"/></svg>
  </a>

</main>

<app-footer id="footer"></app-footer>
