<dialog #loginDialog (auxclick)="loginDialog.close()">
    <h2>CAL Login</h2>
    <div class="dialog-body flex-column">

        <form #heroForm="ngForm" (ngSubmit)="showPinField ? download() : getCalToken($event)" class="flex-column">
            <mat-form-field appearance="fill" hideRequiredMarker="true">
                <mat-label>Israeli ID</mat-label>
                <input matInput [(ngModel)]="loginForm.tz" name="tz" maxlength="9" minlength="9" required inputmode="numeric">
            </mat-form-field>

            <mat-form-field  appearance="fill" hideRequiredMarker="true">
                <mat-label>Last 4 digits of your credit card</mat-label>
                <input matInput [(ngModel)]="loginForm.last4Digits" name="last4Digits" type="password" maxlength="4" minlength="4" required inputmode="numeric">
            </mat-form-field>


            <mat-form-field *ngIf="showPinField">
                <mat-label>One-time code</mat-label>
                <input matInput
                       inputmode="numeric"
                       pattern="^\d{1,6}$"
                       autocomplete="one-time-code"
                       maxlength="6"
                       minlength="6"
                       name="pin"
                       required
                       [(ngModel)]="loginForm.pin"
                >
            </mat-form-field>

            <button class="btn" type="submit" *ngIf="!(isLoading || errorMessage)" [disabled]="heroForm.form.invalid" autofocus>
                Get the {{showPinField ? 'Data' : 'Code'}}
            </button>
        </form>

        <progress [hidden]="!isLoading"></progress>
        <div class="mat-mdc-form-field-error" style="width: auto; text-align: center">{{errorMessage}}</div>
    </div>
</dialog>
